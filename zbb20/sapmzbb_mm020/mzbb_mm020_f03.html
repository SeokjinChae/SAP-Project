<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>MZBB_MM020_F03</title>
</head>
<body bgcolor="#FFFFE0">
<font size="3" face = "Arial" color="#000000"><b>Code listing for: MZBB_MM020_F03</b></font>
<br>
<font size="3" face = "Arial" color="#000000"><b>Description:  Include MZBB_MM020_F03</b></font>
<hr>
<pre width="100">
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Include          MZBB_MM020_F03</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Tab 3 : 유통기한 초과 자재 입고 (Screen 130)</font>
<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form user_command_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM USER_COMMAND_0130 .
  CLEAR: GV_WHERE1, GV_WHERE2.
  CASE OK_CODE.
    WHEN 'BTN3'.
      IF ZBBT_MM090-STORNO IS NOT INITIAL.
        GV_WHERE1 = `storno eq zbbt_mm090-storno`.
      ELSE.
        GV_WHERE1 = ``.
      ENDIF.
      IF ZBBT_MM090-MATNO IS NOT INITIAL.
        GV_WHERE2 = `matno eq zbbt_mm090-matno`.
      ELSE.
        GV_WHERE2 = ``.
      ENDIF.
      PERFORM GET_DATA_0130.
    WHEN 'RAD'.
      PERFORM GET_DATA_0130.
    WHEN 'REFBTN3'.
      CLEAR: ZBBT_MM090-STORNO, ZBBT_MM090-MATNO, GV_WHERE1, GV_WHERE2.
      PERFORM GET_DATA_0130.
  ENDCASE.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_data_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM GET_DATA_0130 .

  DATA LV_LIN TYPE I.

  SELECT *
   INTO CORRESPONDING FIELDS OF TABLE GT_MM090_2
   FROM ZBBT_MM090
   WHERE (GV_WHERE1)
   AND (GV_WHERE2)
   AND MDELFLAG EQ '0'
   AND STORNO   NE 'BYW003'
   AND EXPIRDT  LE SY-DATUM.
  SORT GT_MM090_2 BY EXPIRDT ASCENDING.

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE S029 DISPLAY LIKE 'E'. " 데이터가 존재하지 않습니다.
  ELSE.
    DESCRIBE TABLE GT_MM090_2 LINES LV_LIN.

    IF GT_MM090_2 IS NOT INITIAL.
      MESSAGE S009 WITH LV_LIN.      " &건의 데이터 조회에 성공했습니다.
    ELSE.
      MESSAGE S029 DISPLAY LIKE 'E'. " 데이터가 존재하지 않습니다.
    ENDIF.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form make_data_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM MAKE_DATA_0130 .
  CLEAR: GS_MM020, GS_MM010.
  LOOP AT GT_MM090_2 INTO GS_MM090_2.
    " status 아이콘으로
    DATA: LV_DAT TYPE I.
    LV_DAT = SY-DATUM - GS_MM090_2-EXPIRDT. "현재날짜 - 유통기한
    IF LV_DAT = 0. "현날짜 = 유통기한
      GS_MM090_2-STATUS = 3. "초록
    ELSEIF LV_DAT LE 2. "유통기한 초과 2일 내
      GS_MM090_2-STATUS = 2. "노랑
    ELSE. "유통기한 초과 3일 이상
      GS_MM090_2-STATUS = 1. "빨강
      GS_MM090_2-COLOR = 'C600'.
    ENDIF.

    SELECT SINGLE *
      FROM ZBBT_MM020
      INTO GS_MM020
      WHERE MATNO EQ GS_MM090_2-MATNO.
    GS_MM090_2-MATNM = GS_MM020-MATNM.

    SELECT SINGLE *
      FROM ZBBT_MM010
      INTO GS_MM010
      WHERE STORNO EQ GS_MM090_2-STORNO.
    GS_MM090_2-STORNM = GS_MM010-STORNM.

    MODIFY GT_MM090_2 FROM GS_MM090_2 TRANSPORTING STATUS COLOR MATNM STORNM.
  ENDLOOP.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_container_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM CREATE_CONTAINER_0130 .
  CREATE OBJECT GO_CONTAINER4
    EXPORTING
      CONTAINER_NAME = 'MY_CONTROL4'
    EXCEPTIONS
      OTHERS         = 1.

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE A010(BC405_408).
  ENDIF.

  CREATE OBJECT GO_ALV_GRID4
    EXPORTING
      I_PARENT = GO_CONTAINER4
    EXCEPTIONS
      OTHERS   = 1.
  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE A010(BC405_408).
  ENDIF.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_layout_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM SET_LAYOUT_0130 .

  GS_LAYOUT-ZEBRA      = 'X'. "행 얼룩무늬
  GS_LAYOUT-SEL_MODE    = 'A'.
  GS_LAYOUT-CWIDTH_OPT  = 'X'. "열 너비 최적화

  GS_LAYOUT-EXCP_FNAME = 'STATUS'. "예외
  GS_LAYOUT-EXCP_LED = 'X'. "000에서 하나만 표시
  GS_LAYOUT-INFO_FNAME = 'COLOR'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_grid_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM DISPLAY_GRID_0130 .
  CALL METHOD GO_ALV_GRID4-&gt;SET_TABLE_FOR_FIRST_DISPLAY
    EXPORTING
      I_STRUCTURE_NAME = 'ZBBT_MM090'
      I_SAVE           = 'A'
      IS_LAYOUT        = GS_LAYOUT
    CHANGING
      IT_FIELDCATALOG  = GT_FCAT_0130
      IT_OUTTAB        = GT_MM090_2
<font color ="#0000FF">*     it_sort          = gt_sort</font>
    EXCEPTIONS
      OTHERS           = 1.
  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE A012(BC405_408).
  ENDIF.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_fcat_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM SET_FCAT_0130 .

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'STATUS'.
  GS_FCAT-COLTEXT = '입고긴급도'.
  GS_FCAT-KEY = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'BATCHNO'.
  GS_FCAT-COLTEXT = '입고 배치번호'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-KEY = 'X'.
  GS_FCAT-INTLEN = 13.
  GS_FCAT-COL_POS = 1.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'MATNO'.
  GS_FCAT-COLTEXT = '자재코드'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-KEY = ''.
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 2.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'MATNM'.
  GS_FCAT-COLTEXT = '제품명'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-INTLEN = 20.
  GS_FCAT-COL_POS = 3.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'EXPIRDT'.
  GS_FCAT-COLTEXT = '유통기한'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-INTLEN = 10.
  GS_FCAT-COL_POS = 4.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'STORNO'.
  GS_FCAT-COLTEXT = '창고번호'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-INTLEN = 10.
  GS_FCAT-COL_POS = 5.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'STORNM'.
  GS_FCAT-COLTEXT = '창고명'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-KEY = ''.
  GS_FCAT-INTLEN = 10.
  GS_FCAT-COL_POS = 6.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'QUANTITY'.
  GS_FCAT-COLTEXT = '폐기 예정 수량'.
  GS_FCAT-JUST    = 'R'.
  GS_FCAT-INTLEN = 10.
  GS_FCAT-COL_POS = 7.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UNIT'.
  GS_FCAT-COLTEXT = '단위'.
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 8.
  APPEND GS_FCAT TO GT_FCAT_0130.

<font color ="#0000FF">**********************************************************************</font>

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'PERFORMNO'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'PURORDNO'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'DEFPTYPE'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'MDELFLAG'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.
<font color ="#0000FF">*</font>
<font color ="#0000FF">*  CLEAR GS_FCAT.</font>
<font color ="#0000FF">*  GS_FCAT-FIELDNAME = 'ORDERTY'.</font>
<font color ="#0000FF">*  GS_FCAT-NO_OUT = 'X'.</font>
<font color ="#0000FF">*  APPEND GS_FCAT TO GT_FCAT_0130.</font>


  " *--------------------------------------------------------------------*
  " * Include 제거
  " * CREATE_DT, CREATE_TM, CUSER, UPDATE_DT, UPDATE_TM, UUSER
  " *--------------------------------------------------------------------*

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'CREATE_DT'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'CREATE_TM'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'CUSER'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UPDATE_DT'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UPDATE_TM'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UUSER'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_0130.


ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_handler_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM SET_HANDLER_0130 .
  CREATE OBJECT GO_HANDLER.
  SET HANDLER:
               GO_HANDLER-&gt;HANDLE_ON_TOOLBAR_0130 FOR GO_ALV_GRID4,
               GO_HANDLER-&gt;ON_USER_COMMAND_0130 FOR GO_ALV_GRID4.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form on_toolbar_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_OBJECT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM ON_TOOLBAR_0130  USING    P_OBJECT.
  DATA: LS_BUTTON TYPE STB_BUTTON,
        LS_OBJECT TYPE REF TO CL_ALV_EVENT_TOOLBAR_SET.

  LS_OBJECT = P_OBJECT.

<font color ="#0000FF">*   Separator</font>
  LS_BUTTON-BUTN_TYPE = 1.
  INSERT LS_BUTTON INTO TABLE LS_OBJECT-&gt;MT_TOOLBAR.

  CLEAR LS_BUTTON.
  LS_BUTTON-FUNCTION  = 'IN_DISP'.           "fc code
  LS_BUTTON-ICON      = ICON_DELETE.    "icon
  LS_BUTTON-TEXT      = '폐기 재고 입고'.
  LS_BUTTON-BUTN_TYPE = 0.
  INSERT LS_BUTTON INTO TABLE LS_OBJECT-&gt;MT_TOOLBAR. "ls_object안 toolbar 테이블에 저장
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form on_user_command_0130</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_UCOMM</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM ON_USER_COMMAND_0130  USING  P_UCOMM.
  DATA: LT_INDEX TYPE LVC_T_ROW,
        LS_INDEX TYPE LVC_S_ROW,
        LV_ROWS  TYPE I.
  CLEAR GV_ROWID.

  CALL METHOD GO_ALV_GRID4-&gt;GET_SELECTED_ROWS
    IMPORTING
      ET_INDEX_ROWS = LT_INDEX.

<font color ="#0000FF">*  IF SY-SUBRC = 0.</font>
  LV_ROWS = LINES( LT_INDEX ).
<font color ="#0000FF">*  ELSE.</font>
<font color ="#0000FF">*    MESSAGE 'ON_USER_COMMAND_0130: GET_SELECTED_ROWS 에러' TYPE 'E'.</font>
<font color ="#0000FF">*  ENDIF.</font>


  LOOP AT LT_INDEX INTO LS_INDEX.
    GV_ROWID = LS_INDEX-INDEX.
  ENDLOOP.

  READ TABLE GT_MM090_2 INTO GS_MM090_2 INDEX GV_ROWID.

  CASE P_UCOMM.
    WHEN 'IN_DISP'.
      IF LV_ROWS = 0.
        MESSAGE '입고를 진행할 행을 선택하세요.' TYPE 'I'.
      ELSEIF LV_ROWS &lt;&gt; 1.
        MESSAGE '한 건씩만 선택하세요.' TYPE 'I'.
      ELSE.
        CALL SCREEN 131
          STARTING AT 10 10.
<font color ="#0000FF">*        MESSAGE 'index:' && gv_rowid type 'I'.</font>
      ENDIF.
  ENDCASE.

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE 'ON_USER_COMMAND_0130: CASE P_UCOMM 에러' TYPE 'E'.
  ENDIF.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_detail_disp</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM GET_DETAIL_DISP .

  SELECT SINGLE *
    FROM ZBBT_MM090
    INTO CORRESPONDING FIELDS OF GS_MM070
    WHERE BATCHNO   EQ GS_MM090_2-BATCHNO.
  " OR PURORDNO  EQ GS_MM070-PURORDNO.

  MOVE-CORRESPONDING GS_MM070 TO GS_MM070_2.

  " 입고 정보 세팅
<font color ="#0000FF">*  GS_MM070-BATCHNO = GS_MM090-BATCHNO.</font>
  GS_MM070-STORNO = 'BYW003'. " 폐기 창고
  GS_MM070-INDATE = SY-DATUM. " 입고일 오늘
  GS_MM070-INTYPE = '2'.      " 유통기한 초과 폐기 입고
<font color ="#0000FF">*  GS_MM070-MATNO  = GS_MM090-MATNO.</font>
<font color ="#0000FF">*  GS_MM070-QUANTITY = GS_MM090-QUANTITY.</font>
<font color ="#0000FF">*  GS_MM070-UNIT = GS_MM090-UNIT.</font>
  GV_EXPIRDT = GS_MM070-EXPIRDT.

  CLEAR GS_MM070-EXPIRDT.

  MOVE-CORRESPONDING GS_MM070 TO ZBBT_MM070.


ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form in_0131</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM IN_0131 .

  DATA : LT_MM090 TYPE TABLE OF ZBBT_MM090,
         LS_MM090 TYPE ZBBT_MM090,
         LT_PP070 TYPE TABLE OF ZBBT_PP070,
         LS_PP070 TYPE ZBBT_PP070.

  CLEAR GS_MM070.

<font color ="#0000FF">*** 입고 내역 업데이트 ***</font>
  PERFORM SET_BATCHNO.  " 배치번호 설정하고
  " 나머지 필요한 데이터 넣기!
  GS_MM070-PERFORMNO = ZBBT_MM070-PERFORMNO.
  GS_MM070-PURORDNO = ZBBT_MM070-PURORDNO.
  GS_MM070-INDATE = ZBBT_MM070-INDATE.
  GS_MM070-INTYPE = ZBBT_MM070-INTYPE.
  GS_MM070-QUANTITY = ZBBT_MM070-QUANTITY.
  GS_MM070-UNIT  = ZBBT_MM070-UNIT.
  GS_MM070-MATNO = ZBBT_MM070-MATNO.
  GS_MM070-STORNO = ZBBT_MM070-STORNO.
  GS_MM070-CUSER = SY-UNAME.
  GS_MM070-CREATE_DT = SY-DATUM.
  GS_MM070-CREATE_TM = SY-UZEIT.

  MODIFY ZBBT_MM070 FROM GS_MM070.

  IF SY-SUBRC = 0.
    PERFORM UPDATE_MM090_DISP_2. " 재고 현황 업데이트
    IF SY-SUBRC = 0.
      MESSAGE I014. " 입고가 완료되었습니다.
    ELSE.
      MESSAGE S119 DISPLAY LIKE 'E'.  " 데이터 저장에 실패했습니다.
    ENDIF.
  ELSE.
    MESSAGE S021 DISPLAY LIKE 'E'.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form UPDATE_MM090_DISP</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& 폐기 재고 현황 업데이트</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM UPDATE_MM090_DISP.
<font color ="#0000FF">*** 폐기 재고 현황 업데이트 ***</font>
  CLEAR: GS_MM090_2, GS_MM020.
  GS_MM090_2-STORNO = 'BYW003'.
  GS_MM090_2-BATCHNO = GS_MM070-BATCHNO.
  GS_MM090_2-PERFORMNO = GS_MM070-PERFORMNO.
  GS_MM090_2-PURORDNO = GS_MM070-PURORDNO.
  GS_MM090_2-MATNO = GS_MM070-MATNO.
  GS_MM090_2-QUANTITY = GS_MM070-QUANTITY.
  GS_MM090_2-UNIT = GS_MM070-UNIT.
  GS_MM090_2-DEFPTYPE = '0'.
  GS_MM090_2-MDELFLAG = '0'.
  GS_MM090_2-EXPIRDT = GV_EXPIRDT.

<font color ="#0000FF">*  SELECT SINGLE * FROM ZBBT_MM020</font>
<font color ="#0000FF">*     INTO GS_MM020</font>
<font color ="#0000FF">*    WHERE MATNO = GS_MM090-MATNO.</font>
<font color ="#0000FF">*  GS_MM090-EXPIRDT = ZBBT_MM070-INDATE + GS_MM020-EXPDATE.</font>

  MODIFY ZBBT_MM090 FROM GS_MM090_2. "DB에 반영

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE S119 DISPLAY LIKE 'E'.  " 업데이트 실패
  ENDIF.

<font color ="#0000FF">*** 원래 창고에 있던 애들 재고 0으로 만들어주기 ***</font>
  CLEAR: GS_MM090_2.
  GS_MM070_2-QUANTITY = 0.
  GS_MM070_2-MDELFLAG = 4.
  MOVE-CORRESPONDING GS_MM070_2 TO GS_MM090_2.

  MODIFY ZBBT_MM090 FROM GS_MM090_2. "DB에 반영

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE S119 DISPLAY LIKE 'E'.  " 업데이트 실패
  ENDIF.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form UPDATE_MM090_DISP</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& 폐기 재고 현황 업데이트</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM UPDATE_MM090_DISP_2.
<font color ="#0000FF">*** 폐기 재고 현황 업데이트 ***</font>
  CLEAR: GS_MM090_2, GS_MM020.
  GS_MM090_2-STORNO = 'BYW003'.
  GS_MM090_2-BATCHNO = GS_MM070-BATCHNO.
  GS_MM090_2-PERFORMNO = GS_MM070-PERFORMNO.
  GS_MM090_2-PURORDNO = GS_MM070-PURORDNO.
  GS_MM090_2-MATNO = GS_MM070-MATNO.
  GS_MM090_2-QUANTITY = GS_MM070-QUANTITY.
  GS_MM090_2-UNIT = GS_MM070-UNIT.
  GS_MM090_2-DEFPTYPE = '1'.
  GS_MM090_2-MDELFLAG = '0'.
  GS_MM090_2-EXPIRDT = GV_EXPIRDT.

<font color ="#0000FF">*  SELECT SINGLE * FROM ZBBT_MM020</font>
<font color ="#0000FF">*     INTO GS_MM020</font>
<font color ="#0000FF">*    WHERE MATNO = GS_MM090-MATNO.</font>
<font color ="#0000FF">*  GS_MM090-EXPIRDT = ZBBT_MM070-INDATE + GS_MM020-EXPDATE.</font>

  MODIFY ZBBT_MM090 FROM GS_MM090_2. "DB에 반영

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE S119 DISPLAY LIKE 'E'.  " 업데이트 실패
  ENDIF.

<font color ="#0000FF">*** 원래 창고에 있던 애들 재고 0으로 만들어주기 ***</font>
  CLEAR: GS_MM090_2.
  GS_MM070_2-QUANTITY = 0.
  GS_MM070_2-MDELFLAG = 4.
  MOVE-CORRESPONDING GS_MM070_2 TO GS_MM090_2.

  MODIFY ZBBT_MM090 FROM GS_MM090_2. "DB에 반영

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE S119 DISPLAY LIKE 'E'.  " 업데이트 실패
  ENDIF.
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form REFRESH_0131</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM REFRESH_0131 .
  CLEAR: ZBBT_MM090, GS_MM070, GS_MM090.
  PERFORM GET_DATA_0130.
  PERFORM MAKE_DATA_0130.
  CALL SCREEN 0100.
  DATA : LS_STABLE TYPE LVC_S_STBL.
  LS_STABLE-ROW = 'X'.
  LS_STABLE-COL = 'X'.
  IF GO_ALV_GRID4 IS NOT INITIAL.
    CALL METHOD GO_ALV_GRID4-&gt;REFRESH_TABLE_DISPLAY
      EXPORTING
        IS_STABLE = LS_STABLE
<font color ="#0000FF">*       I_SOFT_REFRESH =</font>
      EXCEPTIONS
        FINISHED  = 1
        OTHERS    = 2.
    IF SY-SUBRC &lt;&gt; 0.
      MESSAGE 'CALL METHOD go_alv_grid4-&gt;refresh_table_display 오류' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDFORM.
<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Tab 4 : 입고 내역 조회</font>
<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_data_view</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM GET_DATA_VIEW .
  CLEAR GT_MM070_V.

  SELECT *
    INTO CORRESPONDING FIELDS OF TABLE GT_MM070_V
    FROM ZBBT_MM070
    WHERE (GV_WHERE1)
    ORDER BY BATCHNO.
ENDFORM.

<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& Form make_data_view</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& text</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& --&gt;  p1        text</font>
<font color ="#0000FF">**& &lt;--  p2        text</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
FORM MAKE_DATA_VIEW .

  DATA LV_LIN TYPE I.

  LOOP AT GT_MM070_V INTO GS_MM070_V.
    "1. flag 변경
    IF GS_MM070_V-INTYPE EQ '0'.
      GS_MM070_V-INTYPETXT = '원자재 구매 입고'.
    ELSE. " GS_MM070_V-INTYPE EQ '1'.
      GS_MM070_V-INTYPETXT = '완제품 생산 입고'.
    ENDIF.

<font color ="#0000FF">*      IF gs_mm070_v-inflag EQ '0'.</font>
<font color ="#0000FF">*        gs_mm070_v-status = 2.</font>
<font color ="#0000FF">*      ELSE.</font>
<font color ="#0000FF">*        gs_mm070_v-status = 3.</font>
<font color ="#0000FF">*      ENDIF.</font>

    SELECT SINGLE * INTO GS_MM020
     FROM ZBBT_MM020
     WHERE MATNO EQ GS_MM070_V-MATNO.

    GS_MM070_V-MATNM = GS_MM020-MATNM.

    SELECT SINGLE * INTO GS_MM010
     FROM ZBBT_MM010
     WHERE STORNO EQ GS_MM070_V-STORNO.

    GS_MM070_V-STORNM = GS_MM010-STORNM.

    MODIFY GT_MM070_V FROM GS_MM070_V TRANSPORTING MATNM INTYPETXT STORNM." status.
  ENDLOOP.

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE S029 DISPLAY LIKE 'E'. " 데이터가 존재하지 않습니다.
  ELSE.
    DESCRIBE TABLE GT_MM070_V LINES LV_LIN.

    IF GT_MM070_V IS NOT INITIAL.
      MESSAGE S009 WITH LV_LIN.      " &건의 데이터 조회에 성공했습니다.
    ELSE.
      MESSAGE S029 DISPLAY LIKE 'E'. " 데이터가 존재하지 않습니다.
    ENDIF.
  ENDIF.
ENDFORM.
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& Form CREATE_OBJECT_0140</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& text</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& --&gt;  p1        text</font>
<font color ="#0000FF">**& &lt;--  p2        text</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
FORM CREATE_OBJECT_0140 .
  CREATE OBJECT GO_CONTAINER3
    EXPORTING
      CONTAINER_NAME = 'MY_CONTROL3'
    EXCEPTIONS
      OTHERS         = 1.

  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE A010(BC405_408).
  ENDIF.

  " 2) container 에 grid 를 link.
  CREATE OBJECT GO_ALV_GRID3
    EXPORTING
      I_PARENT = GO_CONTAINER3
    EXCEPTIONS
      OTHERS   = 1.
  IF SY-SUBRC &lt;&gt; 0.
    MESSAGE 'CREATE OBJECT go_alv_grid3 오류.' TYPE 'E'.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_handler_view</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM SET_HANDLER_VIEW .
  CREATE OBJECT GO_HANDLER.
  SET HANDLER : GO_HANDLER-&gt;HANDLE_TOOLBAR FOR GO_ALV_GRID3,
                GO_HANDLER-&gt;HANDLE_USER_COMMAND FOR GO_ALV_GRID3. ",
<font color ="#0000FF">*                go_handler-&gt;handle_double_click FOR go_alv_grid3.</font>
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_layout_view</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM SET_LAYOUT_VIEW .
  GS_LAYOUT2-ZEBRA      = 'X'. "행 얼룩무늬
  GS_LAYOUT2-SEL_MODE    = 'A'.
<font color ="#0000FF">*  gs_layout2-cwidth_opt  = 'X'. "열 너비 최적화</font>
  GS_LAYOUT2-GRID_TITLE = '입고 내역'.
<font color ="#0000FF">*  GS_LAYOUT2-EXCP_FNAME = 'STATUS'. "예외</font>

ENDFORM.
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& Form set_fcat_view</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& text</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
<font color ="#0000FF">**& --&gt;  p1        text</font>
<font color ="#0000FF">**& &lt;--  p2        text</font>
<font color ="#0000FF">**&---------------------------------------------------------------------*</font>
FORM SET_FCAT_VIEW .
  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'BATCHNO'.
  GS_FCAT-COLTEXT = '입고배치번호'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-KEY = 'X'.
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 1.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'INTYPETXT'.
  GS_FCAT-COLTEXT = '입고 유형'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-INTLEN = 10.
  GS_FCAT-COL_POS = 2.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'INDATE'.
  GS_FCAT-COLTEXT = '입고 날짜'.
  GS_FCAT-JUST    = 'L'.
<font color ="#0000FF">*  GS_FCAT-KEY = 'X'.</font>
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 3.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'MATNO'.
  GS_FCAT-COLTEXT = '자재 코드'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 4.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'MATNM'.
  GS_FCAT-COLTEXT = '제품명'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 5.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'QUANTITY'.
  GS_FCAT-COLTEXT = '수량'.
  GS_FCAT-JUST    = 'R'.
  GS_FCAT-OUTPUTLEN = 8.
  GS_FCAT-COL_POS = 6.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UNIT'.
  GS_FCAT-COLTEXT = '단위'.
  GS_FCAT-JUST    = 'L'.
  GS_FCAT-OUTPUTLEN = 4.
  GS_FCAT-COL_POS = 7.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'PURORDNO'.
  GS_FCAT-COLTEXT = '구매오더번호'.
  GS_FCAT-JUST    = 'C'.
  GS_FCAT-INTLEN = 12.
  GS_FCAT-COL_POS = 8.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'PERFORMNO'.
  GS_FCAT-COLTEXT = '생산실적번호'.
  GS_FCAT-JUST    = 'C'.
  GS_FCAT-INTLEN = 12.
  GS_FCAT-COL_POS = 9.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'STORNO'.
  GS_FCAT-COLTEXT = '창고번호'.
  GS_FCAT-INTLEN = 15.
  GS_FCAT-COL_POS = 10.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'STORNM'.
  GS_FCAT-COLTEXT = '창고이름'.
  GS_FCAT-INTLEN = 12.
  GS_FCAT-COL_POS = 11.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

<font color ="#0000FF">*  CLEAR GS_FCAT.</font>
<font color ="#0000FF">*  GS_FCAT-FIELDNAME = 'STATUS'.</font>
<font color ="#0000FF">*  GS_FCAT-COLTEXT = '입고 상태'.</font>
<font color ="#0000FF">*  GS_FCAT-JUST    = 'C'.</font>
<font color ="#0000FF">*  GS_FCAT-INTLEN = 20.</font>
<font color ="#0000FF">*  GS_FCAT-COL_POS = 10.</font>
<font color ="#0000FF">*  APPEND GS_FCAT TO GT_FCAT_VIEW.</font>

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'INTYPE'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  " *--------------------------------------------------------------------*
  " * Include 제거
  " * CREATE_DT, CREATE_TM, CUSER, UPDATE_DT, UPDATE_TM, UUSER
  " *--------------------------------------------------------------------*

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'CREATE_DT'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'CREATE_TM'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'CUSER'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UPDATE_DT'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UPDATE_TM'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.

  CLEAR GS_FCAT.
  GS_FCAT-FIELDNAME = 'UUSER'.
  GS_FCAT-NO_OUT = 'X'.
  APPEND GS_FCAT TO GT_FCAT_VIEW.


ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_sorting</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM SET_SORTING .

<font color ="#0000FF">*      gs_sort-fieldname = 'ORDERNO'.</font>
<font color ="#0000FF">*      gs_sort-spos      = 1.</font>
<font color ="#0000FF">*      APPEND gs_sort TO gt_sort.</font>

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_grid_view</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM DISPLAY_GRID_VIEW .
  IF GO_ALV_GRID3 IS NOT INITIAL.
    CALL METHOD GO_ALV_GRID3-&gt;SET_TABLE_FOR_FIRST_DISPLAY
      EXPORTING
        I_STRUCTURE_NAME = 'ZBBT_MM070'
        I_SAVE           = 'A'
        IS_LAYOUT        = GS_LAYOUT2
      CHANGING
        IT_FIELDCATALOG  = GT_FCAT_VIEW
        IT_OUTTAB        = GT_MM070_V
<font color ="#0000FF">*       IT_SORT          = GT_SORT</font>
        IT_FILTER        = GT_FILTER
      EXCEPTIONS
        OTHERS           = 1.
    IF SY-SUBRC &lt;&gt; 0.
      MESSAGE A012(BC405_408).
    ENDIF.
  ENDIF.


ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form double_click</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_ROW</font>
<font color ="#0000FF">*&      --&gt; E_COLUMN</font>
<font color ="#0000FF">*&      --&gt; ES_ROW_NO</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM DOUBLE_CLICK  USING    PV_ROW TYPE LVC_S_ROW
                            PV_COLUMN
                            PV_ROW_NO TYPE LVC_S_ROID.
<font color ="#0000FF">*  CLEAR: gs_mm080_v, gs_mm085, gt_fcat_view2.</font>
<font color ="#0000FF">*  READ TABLE gt_mm080_v INTO gs_mm080_v INDEX pv_row_no-row_id.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*  SELECT *</font>
<font color ="#0000FF">*    INTO CORRESPONDING FIELDS OF TABLE gt_mm085_v</font>
<font color ="#0000FF">*    FROM zbbt_mm085</font>
<font color ="#0000FF">*    WHERE outno = gs_mm080_v-outno.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*  LOOP AT gt_mm085_v INTO gs_mm085_v.</font>
<font color ="#0000FF">*    DATA: lv_90 TYPE zbbt_mm090. "pp bom item</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*    SELECT SINGLE * INTO lv_90</font>
<font color ="#0000FF">*      FROM zbbt_mm090</font>
<font color ="#0000FF">*      WHERE batchno EQ gs_mm085_v-batchno.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*      SELECT SINGLE * INTO gs_mm020</font>
<font color ="#0000FF">*      FROM zbbt_mm020</font>
<font color ="#0000FF">*      WHERE matno EQ lv_90-matno.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*      gs_mm085_v-matnm = gs_mm020-matnm.</font>
<font color ="#0000FF">*      MODIFY gt_mm085_v FROM gs_mm085_v TRANSPORTING matnm.</font>
<font color ="#0000FF">*   ENDLOOP.</font>
ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form toolbar</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_OBJECT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM TOOLBAR  USING PC_OBJECT TYPE REF TO CL_ALV_EVENT_TOOLBAR_SET.
  DATA: LS_BUTTON TYPE STB_BUTTON,
        LS_OBJECT TYPE REF TO CL_ALV_EVENT_TOOLBAR_SET.

  LS_OBJECT = PC_OBJECT.

<font color ="#0000FF">*   Separator</font>
  LS_BUTTON-BUTN_TYPE = 3.
  INSERT LS_BUTTON INTO TABLE LS_OBJECT-&gt;MT_TOOLBAR.

  CLEAR LS_BUTTON.
  LS_BUTTON-FUNCTION  = 'refresh'. "fc code
  LS_BUTTON-ICON      = ICON_SELECT_ALL.    "icon
  LS_BUTTON-TEXT      = '전체'.
  LS_BUTTON-BUTN_TYPE = 0.
  INSERT LS_BUTTON INTO TABLE LS_OBJECT-&gt;MT_TOOLBAR. "ls_object안 toolbar 테이블에 저장

  CLEAR LS_BUTTON.
  LS_BUTTON-FUNCTION  = 'fc_mm'.
  LS_BUTTON-TEXT      = '원자재 입고 내역'.
  LS_BUTTON-ICON      = ICON_TRANSPORT.    "icon
  LS_BUTTON-BUTN_TYPE = 0.
  INSERT LS_BUTTON INTO TABLE LS_OBJECT-&gt;MT_TOOLBAR.

  CLEAR LS_BUTTON.
  LS_BUTTON-FUNCTION  = 'fc_pp'. "fc code
  LS_BUTTON-ICON      = ICON_PPE_PLINE.    "icon
  LS_BUTTON-TEXT      = '완제품 입고 내역'.
  LS_BUTTON-BUTN_TYPE = 0.
  INSERT LS_BUTTON INTO TABLE LS_OBJECT-&gt;MT_TOOLBAR. "ls_object안 toolbar 테이블에 저장

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form user_command</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_UCOMM</font>
<font color ="#0000FF">*&      --&gt; GV_ROW</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM USER_COMMAND  USING    P_UCOMM TYPE SY-UCOMM
                            PV_ROW TYPE I.

<font color ="#0000FF">*  DATA LV_LIN TYPE I.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*  CLEAR: GV_WHERE1.</font>

  CASE P_UCOMM.
    WHEN 'refresh'. " 전체
<font color ="#0000FF">*      GV_WHERE1 = ``.</font>
<font color ="#0000FF">*      PERFORM GET_DATA_VIEW.</font>
      CLEAR GT_FILTER.

    WHEN 'fc_pp'.  " 완제품 입고 내역
<font color ="#0000FF">*      GV_WHERE1 = `intype eq '1'`.</font>
<font color ="#0000FF">*      PERFORM GET_DATA_VIEW.</font>

      CLEAR: GS_FILTER, GT_FILTER.
      GS_FILTER-FIELDNAME = 'INTYPE'.
      GS_FILTER-SIGN = 'I'.
      GS_FILTER-OPTION = 'EQ'.
      GS_FILTER-LOW = '1'.
      APPEND GS_FILTER TO GT_FILTER.

    WHEN 'fc_mm'.  " 원자재 입고 내역
<font color ="#0000FF">*      GV_WHERE1 = `intype eq '1'`.</font>
<font color ="#0000FF">*      PERFORM GET_DATA_VIEW.</font>

      CLEAR: GS_FILTER, GT_FILTER.
      GS_FILTER-FIELDNAME = 'INTYPE'.
      GS_FILTER-SIGN = 'I'.
      GS_FILTER-OPTION = 'EQ'.
      GS_FILTER-LOW = '0'.
      APPEND GS_FILTER TO GT_FILTER.

<font color ="#0000FF">*       gs_sort-fieldname = 'ORDERNO'.</font>
<font color ="#0000FF">*        gs_sort-spos      = 1.</font>
<font color ="#0000FF">*        APPEND gs_sort TO gt_sort.</font>
<font color ="#0000FF">*      PERFORM set_sorting.</font>

  ENDCASE.

  PERFORM DISPLAY_GRID_VIEW.

<font color ="#0000FF">*  IF SY-SUBRC &lt;&gt; 0.</font>
<font color ="#0000FF">*    MESSAGE S029 DISPLAY LIKE 'E'. " 데이터가 존재하지 않습니다.</font>
<font color ="#0000FF">*  ELSE.</font>
<font color ="#0000FF">*    DESCRIBE TABLE GT_MM070_V LINES LV_LIN.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*    IF GT_MM070_V IS NOT INITIAL.</font>
<font color ="#0000FF">*      MESSAGE S009 WITH LV_LIN.      " &건의 데이터 조회에 성공했습니다.</font>
<font color ="#0000FF">*    ELSE.</font>
<font color ="#0000FF">*      MESSAGE S029 DISPLAY LIKE 'E'. " 데이터가 존재하지 않습니다.</font>
<font color ="#0000FF">*    ENDIF.</font>
<font color ="#0000FF">*  ENDIF.</font>

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form CHECK_DATA3</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM CHECK_DATA3 .
  DATA: LV_STORNO TYPE ZBBT_MM090-STORNO,
        LV_MATNO  TYPE ZBBT_MM090-MATNO.

  IF ZBBT_MM090-STORNO IS NOT INITIAL.
    SELECT SINGLE STORNO INTO LV_STORNO
        FROM ZBBT_MM090
        WHERE STORNO = ZBBT_MM090-STORNO.
    IF SY-SUBRC &lt;&gt; 0.
      CLEAR: ZBBT_MM090-STORNO.
      MESSAGE S105 WITH '창고번호' DISPLAY LIKE 'E'.
    ENDIF.
  ENDIF.

  IF ZBBT_MM090-MATNO IS NOT INITIAL.
    SELECT SINGLE MATNO INTO LV_MATNO
        FROM ZBBT_MM090
        WHERE MATNO = ZBBT_MM090-MATNO.
    IF SY-SUBRC &lt;&gt; 0.
      CLEAR: ZBBT_MM090-MATNO.
      MESSAGE S105 WITH '자재코드' DISPLAY LIKE 'E'.
    ENDIF.
  ENDIF.
ENDFORM.
</pre>
<hr>
<font size="2" face = "Sans Serif">Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 754
</font>
</body>
</html>
